name: Get next semantic version

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Current version (e.g. 2.8.1)"
        required: true
        type: string
      bump:
        description: "Which part to bump: major, minor, patch"
        required: true
        type: string
  workflow_call:
    inputs:
      version:
        description: "Current version (e.g. 2.8.1)"
        required: true
        type: string
      bump:
        description: "Which part to bump: major, minor, patch"
        required: true
        type: string
    outputs:
      next_version:
        description: "Next SemVer version (e.g. 2.8.2)"
        value: ${{ jobs.next.outputs.next_version }}
      next_tag:
        description: "Next tag form with release/ prefix (e.g. release/2.8.2)"
        value: ${{ jobs.next.outputs.next_tag }}

jobs:
  next:
    runs-on: ubuntu-latest
    outputs:
      next_version: ${{ steps.bump.outputs.next_version }}
      next_tag: ${{ steps.bump.outputs.next_tag }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Init NodeJS
        uses: ./.github/actions/setup-github-actions-node

      - name: Compute next semantic version
        id: bump
        working-directory: scripts/github-actions
        env:
          VERSION: ${{ inputs.version }}
          BUMP: ${{ inputs.bump }}
        run: node ./next-semver.mjs

      - name: Print detected versions
        run: |
          echo "Next version: ${{ steps.bump.outputs.next_version }}"
          echo "Next tag:     ${{ steps.bump.outputs.next_tag }}"
